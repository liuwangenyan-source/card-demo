<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Knowledge Card Demo - Cards</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .hint { color: #666; font-size: 13px; }
    button { padding: 8px 12px; cursor: pointer; }
    .card { border: 1px solid #e5e7eb; border-radius: 10px; padding: 12px; margin: 12px 0; }
    .title { font-weight: 700; margin-bottom: 6px; }
    .meta { font-size: 12px; color: #666; margin-bottom: 8px; }
    pre { white-space: pre-wrap; word-break: break-word; background: #f6f8fa; padding: 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>卡片库（最近 30 条）</h1>
  <p class="hint">从你的 n8n Cloud API（/cards）拉取列表。</p>
  <button id="reload">刷新</button>
  <div id="status" class="hint"></div>
  <div id="list"></div>

<script>
  // ✅ 改这里：换成你的 n8n Cloud 域名（不要带最后的 /）
  const API_BASE = "https://ydhsszqulwdsibbodyou.supabase.co/functions/v1/api";

  const status = document.getElementById('status');
  const list = document.getElementById('list');
  const reload = document.getElementById('reload');

  async function load() {
    status.textContent = "加载中…";
    list.innerHTML = "";

    try {
      const res = await fetch(`${API_BASE}/webhook/cards`, { method: "GET" });
      const data = await res.json();

      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      if (!Array.isArray(data)) throw new Error("返回不是数组（请检查 /cards workflow 的 Respond）");

      status.textContent = `加载成功：${data.length} 条`;
      data.forEach(item => {
        const div = document.createElement('div');
        div.className = "card";
        div.innerHTML = `
          <div class="title">${item.title || "(no title)"}</div>
          <div class="meta">${item.created_at || ""} · topics: ${(item.topics || []).join(", ")}</div>
          <pre>${item.markdown || ""}</pre>
        `;
        list.appendChild(div);
      });
    } catch (e) {
      status.textContent = "加载失败：" + String(e);
    }
  }

  reload.onclick = load;
  load();
</script>
</body>
</html>
